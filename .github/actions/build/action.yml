name: 'Build'
description: 'Builds project and uploads artifacts'
inputs:
  shell:
    require: true
    type: string
  package-name:
    required: true
    type: string
  package-sdk:
    default: false
    required: false
    type: boolean
  requires-sdk:
    default: false
    required: false
    type: boolean
  script:
    required: true
    type: string
  sdk-name:
    default: false
    required: false
    type: boolean
  os:
    required: true
    type: string
  arch:
    required: true
    type: string
  aws-access-key-id:
    required: true
    type: string
  aws-secret-access-key:
    required: true
    type: string
  aws-region:
    required: true
    type: string

runs:
  using: "composite"
  steps:
      - name: Get SDK
        if: ${{inputs.requires-sdk}}
        uses: febiosoftware/febio-workflows/.github/actions/get-sdk@reusable-worfklow-macos
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ inputs.aws-region }}
          shell: ${{ inputs.shell }}
          os: ${{inputs.os}}
          arch: ${{inputs.arch}}
    - name: Build
      shell: ${{inputs.shell}}
      run: |
        ${{ inputs.script }}
    - name: Upload Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: ${{ inputs.package-name }}-${{inputs.os}}-${{inputs.arch}}
        path: |
          cmbuild/bin
          cmbuild/lib
          !cmbuild/lib/*.a
    - name: Create and upload SDK
      if: ${{ inputs.package-sdk }}
      uses: febiosoftware/febio-workflows/.github/actions/create-sdk@reusable-worfklow-macos
      with:
        shell: ${{ inputs.shell }}
        package-name: ${{ inputs.package-name }}
        script: ci/${{inputs.os}}/create-sdk.sh
        os: ${{inputs.os}}
        arch: ${{inputs.arch}}
